angular.module("myApp",["app.routes","authService","mainCtrl"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("login",{url:"/login",templateUrl:"app/views/login.html",controller:"mainController",controllerAs:"login"}).state("signup",{url:"/signup",templateUrl:"app/views/signup.html",controller:"mainController",controllerAs:"signup"})}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth",function(e,t,n){var o=this;o.loggedIn=n.isLoggedIn(),e.$on("$routeChangeStart",function(){o.loggedIn=n.isLoggedIn(),n.getUser().then(function(e){o.user=e.data})}),o.signup=function(){o.processing=!0,o.error="",n.register(o.loginData.name,o.loginData.username,o.loginData.password).success(function(e){o.processing=!1,e.success?t.path("/login"):o.error=e.message})},o.login=function(){o.processing=!0,o.error="",n.login(o.loginData.username,o.loginData.password).success(function(e){o.processing=!1,e.success?t.path("/users"):o.error=e.message})},o.logout=function(){n.logout(),o.user="",t.path("/login")}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,n){var o={};return o.register=function(t,o,r){return e.post("api/register",{name:t,username:o,password:r}).success(function(e){return n.setToken(e.token),e})},o.login=function(t,o){return e.post("/api/authenticate",{username:t,password:o}).success(function(e){return n.setToken(e.token),e})},o.logout=function(){n.setToken()},o.isLoggedIn=function(){return n.getToken()?!0:!1},o.getUser=function(){return n.getToken()?e.get("/api/me",{cache:!0}):t.reject({message:"User has no token."})},o}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,n){var o={};return o.request=function(e){var t=n.getToken();return t&&(e.headers["x-access-token"]=t),e},o.responseError=function(o){return 403==o.status&&(n.setToken(),t.path("/login")),e.reject(o)},o}]);
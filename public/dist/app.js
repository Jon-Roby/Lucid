angular.module("myApp",["app.routes","ngAnimate","angularMoment","authService","mainCtrl","postsDisplayCtrl","postsDisplayService","iconsCtrl","iconsService","userSidebarCtrl","userSidebarService","postDisplayCtrl","postDisplayService","postAuthorCtrl","postAuthorService","postCreateCtrl","postCreateService","userDisplayCtrl","userDisplayService"]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]),angular.module("app.routes",["ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,s){t.otherwise("/"),e.state("login",{url:"/login",templateUrl:"app/views/pages/users/login.html",controller:"mainController",controllerAs:"login"}).state("signup",{url:"/signup",templateUrl:"app/views/pages/users/signup.html",controller:"mainController",controllerAs:"signup"}).state("users",{url:"/users",templateUrl:"app/views/pages/users/all.html",controller:"userController",controllerAs:"user"}).state("posts",{url:"/posts",views:{"":{templateUrl:"app/components/postsDisplay/postsDisplayLayout.html"},"postsDisplay@posts":{templateUrl:"app/components/postsDisplay/postsDisplayView.html",controller:"postsDisplayController",controllerAs:"postsDisplay"},"icons@posts":{templateUrl:"app/components/icons/iconsView.html",controller:"iconsController",controllerAs:"icons"},"menu@posts":{templateUrl:"app/components/userSidebar/userSidebarView.html",controller:"userSidebarController",controllerAs:"menu"}}}).state("postCreate",{url:"/posts/create",templateUrl:"app/components/postCreate/postCreateView.html",controller:"postCreateController",controllerAs:"post"}).state("post",{url:"/posts/:post_id",views:{"":{templateUrl:"app/components/postDisplay/postDisplayLayout.html"},"postDisplay@post":{templateUrl:"app/components/postDisplay/postDisplayView.html",controller:"postDisplayController",controllerAs:"postDisplay"},"postDetails@post":{templateUrl:"app/components/postDisplay/postDisplayDetails.html",controller:"postDisplayController",controllerAs:"postDisplay"},"postAuthor@post":{templateUrl:"app/components/postAuthor/postAuthorView.html",controller:"postAuthorController",controllerAs:"postAuthor"},"menu@post":{templateUrl:"app/components/userSidebar/userSidebarView.html",controller:"userSidebarController",controllerAs:"menu"}}}).state("postEdit",{url:"/posts/:post_id/edit",templateUrl:"app/components/postCreate/postCreateView.html",controller:"postEditController",controllerAs:"post"}).state("profile",{url:"/users/:user_id",templateUrl:"app/components/userDisplay/userDisplayView.html",controller:"userDisplayController",controllerAs:"user"}),s.html5Mode(!0)}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(e,t,s){var r={};return r.register=function(t,r,o){return e.post("api/register",{name:t,username:r,password:o}).success(function(e){return s.setToken(e.token),e})},r.login=function(t,r){return e.post("/api/authenticate",{username:t,password:r}).success(function(e){return s.setToken(e.token),e})},r.logout=function(){s.setToken()},r.isLoggedIn=function(){return s.getToken()?!0:!1},r.getUser=function(){return s.getToken()?e.get("/api/me",{cache:!0}):t.reject({message:"User has no token."})},r}]).factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,s){var r={};return r.request=function(e){var t=s.getToken();return t&&(e.headers["x-access-token"]=t),e},r.responseError=function(r){return 403==r.status&&(s.setToken(),t.path("/login")),e.reject(r)},r}]),angular.module("postService",[]).factory("Post",["$http",function(e){var t={};return t.all=function(){return e.get("/api/posts/")},t.get=function(t){return e.get("/api/posts/"+t)},t.getUserId=function(t){return e.get("/api/users/"+t)},t.upvotePost=function(t){return e.put("/api/posts/"+t+"/upvote")},t.bookmark=function(t,s){return e.put("/api/users/"+t+"/bookmark",s)},t.subscribeToAuthor=function(t,s){return e.put("/api/users/"+t._id+"/subscribe",s)},t.getIcons=function(){return e.get("api/users/icons")},t.create=function(t){return e.post("/api/posts/",t)},t.update=function(t,s){return e.put("/api/posts/post/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/posts/post/"+t)},t}]),angular.module("userService",[]).factory("User",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,s){return e.put("/api/users/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]),angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth",function(e,t,s){var r=this;r.loggedIn=s.isLoggedIn(),e.$on("$routeChangeStart",function(){r.loggedIn=s.isLoggedIn(),s.getUser().then(function(e){r.user=e.data})}),r.trending="trending",r.recent="recent",r.popular="popular",r.selectedTab=r.trending,console.log("main.selectedTab === vm.recent: "+(r.selectedTab===r.recent).toString()),console.log("main.selectedTab === vm.popular: "+(r.selectedTab===r.popular).toString()),r.switchTab=function(e){r.selectedTab=e,console.log("main.selectedTab === vm.recent: "+(r.selectedTab===r.recent).toString()),console.log("main.selectedTab === vm.popular: "+(r.selectedTab===r.popular).toString())},r.signup=function(){r.processing=!0,r.error="",s.register(r.loginData.name,r.loginData.username,r.loginData.password).success(function(e){r.processing=!1,e.success?t.path("/posts"):r.error=e.message})},r.login=function(){r.processing=!0,r.error="",s.logout(),s.login(r.loginData.username,r.loginData.password).success(function(e){r.processing=!1,e.success?t.path("/posts"):r.error=e.message})},r.logout=function(){console.log("culkjlkjlkj"),s.logout(),r.user=""}}]),angular.module("userDisplayCtrl",["userService"]).controller("userDisplayController",["User",function(e){var t=this;t.processing=!0,e.all().success(function(e){t.processing=!1,t.users=e}),t.deleteUser=function(s){t.processing=!0,e["delete"](s).success(function(s){e.all().success(function(e){t.processing=!1,t.users=e})})}}]).controller("userCreateController",["User",function(e){var t=this;t.type="create",t.saveUser=function(){t.processing=!0,t.message="",e.create(t.userData).success(function(e){t.processing=!1,t.userData={},t.message=e.message})}}]).controller("userEditController",["$routeParams","User",function(e,t){var s=this;s.type="edit",t.get(e.user_id).success(function(e){s.userData=e}),s.saveUser=function(){s.processing=!0,s.message="",t.update(e.user_id,s.userData).success(function(e){s.processing=!1,s.userData={},s.message=e.message})}}]).controller("userProfileController",["$routeParams","User",function(e,t){var s=this;s.processing=!0,t.get(e.user_id).success(function(e){s.userData=e}),s.deleteUser=function(e){s.processing=!0,t["delete"](e).success(function(e){t.all().success(function(e){s.processing=!1,s.users=e})})}}]),angular.module("iconsCtrl",["iconsService"]).controller("iconsController",["Icons","Auth",function(e,t){var s=this;s.processing=!0,e.getIcons().success(function(e){s.icons=e})}]),angular.module("iconsService",[]).factory("Icons",["$http",function(e){var t={};return t.getIcons=function(){return e.get("api/users/icons")},t}]),angular.module("postAuthorCtrl",["postAuthorService"]).controller("postAuthorController",["PostAuthor","Auth","$stateParams",function(e,t,s){var r=this;r.processing=!0,t.getUser().then(function(t){e.getUserId(t.data._id).success(function(e){r.userData=e})}),e.get(s.post_id).success(function(t){r.post=t,e.getUserId(r.post.authorId).success(function(e){r.post.userData=e})}),r.subscribeToAuthor=function(){e.subscribeToAuthor(r.userData,r.post).success(function(s){t.getUser().then(function(t){e.getUserId(t.data._id).success(function(e){r.userData=e})})})}}]),angular.module("postAuthorService",[]).factory("PostAuthor",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/posts/"+t)},t.getUserId=function(t){return e.get("/api/users/"+t)},t.subscribeToAuthor=function(t,s){return e.put("/api/users/"+t._id+"/subscribe",s)},t}]),angular.module("postCreateCtrl",["postCreateService"]).controller("postCreateController",["PostCreate",function(e){var t=this;t.type="create",t.savePost=function(){t.processing=!0,t.message="",e.create(t.postData).success(function(e){t.processing=!1,t.postData={},t.message=e.message})}}]).controller("postEditController",["$stateParams","PostCreate",function(e,t){var s=this;s.type="edit",t.get(e.post_id).success(function(e){s.postData=e}),s.savePost=function(){s.processing=!0,s.message="",t.update(e.post_id,s.postData).success(function(e){s.processing=!1,s.postData={},s.message=e.message})}}]),angular.module("postCreateService",[]).factory("PostCreate",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/posts/"+t)},t.getUserId=function(t){return e.get("/api/users/"+t)},t.create=function(t){return e.post("/api/posts/",t)},t.update=function(t,s){return e.put("/api/posts/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/posts/"+t)},t}]),angular.module("postDisplayCtrl",["postDisplayService"]).controller("postDisplayController",["$stateParams","PostDisplay","Auth",function(e,t,s){var r=this;s.getUser().then(function(e){t.getUserId(e.data._id).success(function(e){r.userData=e})}),t.get(e.post_id).success(function(e){r.post=e}),r.deletePost=function(e){r.userData._id===r.post.authorId&&t["delete"](e).success(function(e){t.all().success(function(e){r.processing=!1,r.posts=e})})},r.upvotePost=function(){t.upvotePost(r.post._id).success(function(s){t.get(e.post_id).success(function(e){r.post=e})})},r.bookmark=function(){t.bookmark(r.userData._id,r.post).success(function(e){s.getUser().then(function(e){t.getUserId(e.data._id).success(function(e){r.userData=e})})})},r.subscribeToAuthor=function(){t.subscribeToAuthor(r.userData,r.post).success(function(e){s.getUser().then(function(e){t.getUserId(e.data._id).success(function(e){r.userData=e})})})}}]),angular.module("postDisplayService",[]).factory("PostDisplay",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/posts/"+t)},t.getUserId=function(t){return e.get("/api/users/"+t)},t.upvotePost=function(t){return e.put("/api/posts/"+t+"/upvote")},t.bookmark=function(t,s){return e.put("/api/users/"+t+"/bookmark",s)},t["delete"]=function(t){return e["delete"]("/api/posts/post/"+t)},t}]),angular.module("postsDisplayCtrl",["postsDisplayService"]).controller("postsDisplayController",["PostsDisplay","Auth",function(e,t){var s=this;s.processing=!0,e.all().success(function(e){s.processing=!1,s.posts=e})}]),angular.module("postsDisplayService",[]).factory("PostsDisplay",["$http",function(e){var t={};return t.all=function(){return e.get("/api/posts/")},t}]),angular.module("userDisplayCtrl",["userDisplayService"]).controller("userDisplayController",["UserDisplay","$stateParams",function(e,t){var s=this;s.processing=!0,e.get(t.user_id).success(function(e){s.userData=e})}]),angular.module("userDisplayService",[]).factory("UserDisplay",["$http",function(e){var t={};return t.get=function(t){return e.get("/api/users/"+t)},t.all=function(){return e.get("/api/users/")},t.create=function(t){return e.post("/api/users/",t)},t.update=function(t,s){return e.put("/api/users/"+t,s)},t["delete"]=function(t){return e["delete"]("/api/users/"+t)},t}]),angular.module("userSidebarCtrl",["userSidebarService"]).controller("userSidebarController",["UserSidebar","Auth",function(e,t){var s=this;s.processing=!0,t.getUser().then(function(t){e.getUserId(t.data._id).success(function(e){console.log(e),s.userData=e})})}]),angular.module("userSidebarService",[]).factory("UserSidebar",["$http",function(e){var t={};return t.getUserId=function(t){return e.get("/api/users/"+t)},t}]);